!function(){"use strict";var t=window.pix,e=t&&t.member_token,o=t&&t.domain_append,a=(t&&t.isMobile,t&&t.owner,o?"http:":"https:"),n=a+"//panel.pixnet.cc"+o+"/login/openid?openid="+a+"//member.pixnet.cc"+o+"/login&easy_login=1&done=",r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)};function l(t,e){if(window.localStorage){if("object"===(void 0===e?"undefined":r(e)))return void window.localStorage.setItem(t,window.JSON.stringify(e));window.localStorage.setItem(t,e)}}function c(t){return"number"!=typeof t&&(t=Number(t)),t<10?"0"+t:t}var s=document.getElementById("header-prompt"),d=!1,f={init:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&s?this.showToast("發生錯誤，請稍候再試！"):s&&this.showToast(e)},showToast:function(t){var e=t?'<a class="header-prompt__link" href="https://www.pixnet.net">關注成功!到 <span>首頁興趣牆</span> 持續追蹤</a>':"已取消關注！";s.innerHTML=e,s.classList.add("prompt-success");var o=s.querySelector(".header-prompt__link");o&&o.addEventListener("click",function(){f.recordToastEvent("click-toast-to-index")}),d||(d=!0,setTimeout(function(){s.classList.remove("prompt-success"),d=!1},8e3)),this.recordToastEvent("imps-toast-to-index","關注成功")},recordToastEvent:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";window.ga("articleFooterColdstart.send","event","mobileClick",t,e),_piq.push(["trackEvent","mobileClick",t,e])}},u=document.querySelectorAll(".article-footer-tags"),g=document.querySelectorAll(".article-footer-tags .tag"),p=document.querySelectorAll(".article-footer-tags .tag__block"),w="01",h=Number(function(t){if(!t)return"";var e,o,a=window.location.search.substring(1).split("&");for(e=0;e<a.length;e++)if((o=a[e].split("="))[0]===t)return decodeURIComponent(o[1]);return""}("tags"))||6,m=[2,3,5,6],v=[3,4],y=5,_=6,b="utm_source=PIXNET&utm_medium=Blog_article_tag_rule"+w+c(h),L=[],S="/api/blog/tagfollow";function k(){if(u.length)if(dataLayer.push({tagNum:g.length}),dataLayer.push({tagVersion:c(h)}),[].concat(i(g)).forEach(function(t){var e=t.dataset.tag.toLowerCase();t.href=t.href+"?"+b,-1===L.indexOf(e)&&L.push(e)}),[].concat(i(u)).forEach(function(t){if(m.indexOf(h)>-1){var e=t.querySelector(".tag__header-title"),o=t.querySelector(".tag__header-sub-title");e.innerHTML="文章標籤",o.innerHTML=""}h===_&&(t.classList.remove("article-footer-tags"),t.classList.add("origin-tags")),h===y&&t.classList.add("article-footer-tags--hide-follow"),v.indexOf(h)>-1&&t.classList.add("article-footer-tags--follow-border")}),e)axios.get(S,{params:{tags:L}}).then(function(t){var e=function(t){if(window.localStorage){var e=window.localStorage.getItem(t);return"string"==typeof e?window.JSON.parse(e):e}}("article-footer-tag"),o=e&&e.clickedTagName,a=t.data&&t.data.data;[].concat(i(p)).forEach(function(t){var e=t.querySelector(".tag"),o=t.querySelector(".tag-follow-btn"),n=e.dataset.tag.toLowerCase(),r=t.classList;a.forEach(function(t){return t.toLowerCase()}),a.length&&a.indexOf(n)>-1&&(r.add("tag__block--followed"),o.dataset.followSwitch="unfollow"),o.addEventListener("click",function(){var e=r.contains("tag__block--followed");!function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments[2],a=e?"delete":"post";o.querySelector(".tag-follow-btn").dataset.followSwitch=e?"follow":"unfollow",axios[a](S+"?tag="+t).then(function(e){o.classList.toggle("tag__block--followed"),"post"===a?(f.init(),x(t)):f.init(!1,!1)})}(n,e,t)})});var n=!1;o&&!n&&L.indexOf(o)>-1&&-1===a.indexOf(o)&&axios.post(S+"?tag="+o).then(function(t){n=!0,l("article-footer-tag",{}),[].concat(i(p)).forEach(function(t){var e=t.querySelector(".tag");e.dataset.tag.toLowerCase().indexOf(o)>-1&&t.classList.add("tag__block--followed")}),x(o),f.init()})});else{var t=location.href+(location.search?"&":"?")+b;[].concat(i(p)).forEach(function(e){var o=e.querySelector(".tag");e.querySelector(".tag-follow-btn").addEventListener("click",function(){l("article-footer-tag",{clickedTagName:o.dataset.tag.toLowerCase()}),location.href=n+encodeURIComponent(t)})})}}function x(t){dataLayer.push({event:"articleFooterTest",eventCategory:"article_tag",eventAction:"follow_article_tag_successfully_rule"+w+c(h),eventLabel:t})}document.addEventListener("DOMContentLoaded",function(){k()})}();
