(function($){$(document).ready(function(){setTimeout(function(){var subButtons=document.querySelectorAll(".subscribe-btn.member"),toast=document.getElementById("header-prompt"),showingToast=false;ga("create","UA-408650-33","auto",{name:"subScribeTracker"});Array.prototype.forEach.call(subButtons,function(button){button.addEventListener("click",function(){$.ajax({type:"POST",async:true,dataType:"json",url:"/api/blog/followstatus",success:function(res){var isSub=res.data&&res.data.action==="follow";updateAllButtons(isSub);toast&&showToast(isSub);if(button.parentNode.classList.contains("subscribe-bar")){recordEvent("fixed-author-Intro",res.data.action)}else{recordEvent("author-Intro",res.data.action)}recordToastEvent("imps-toast-to-index",isSub?"關注成功":"取消關注");window.pix.isFollowedOwner=isSub},error:function(data){toast&&showToast("發生錯誤，請稍候再試！")}});function showToast(isSub){var successMsg='<a class="header-prompt__link" href="https://www.pixnet.net">關注成功!到 <span>首頁興趣牆</span> 持續追蹤</a>';var message=isSub?successMsg:"已取消關注！";toast.innerHTML=message;toast.classList.add("prompt-success");var link=toast.querySelector(".header-prompt__link");link&&link.addEventListener("click",function(){recordToastEvent("click-toast-to-index","")});if(!showingToast){showingToast=true;setTimeout(function(){toast.classList.remove("prompt-success");showingToast=false},8e3)}}function updateAllButtons(isSub){var subButtons=document.querySelectorAll(".subscribe-btn.member");Array.prototype.forEach.call(subButtons,function(btn){var buttonText=isSub?"已關注":"關注";btn.setAttribute("data-follow-state",buttonText);btn.classList.toggle("following",isSub)})}function recordEvent(category,label){var _piq=window._piq||[];ga("subScribeTracker.send","event",category,"Button_關注會員",label);_piq.push(["trackEvent",category,"Button_關注會員",label])}function recordToastEvent(action,label){window.ga("articleFooterColdstart.send","event","mobileClick",action,label);_piq.push(["trackEvent","mobileClick",action,label])}})})},0)})})(jQuery);
